# 🔄 完整工作流程指南：設備註冊 → 病患綁定 → 健康監控

## ✅ **您的認知完全正確！**

### 🎯 **完整使用流程**

#### **第一步：設備註冊** (`DeviceManagementPage.tsx`)
在設備管理頁面將設備加入系統，根據設備類型提供不同的識別信息：

| 設備類型 | 必需欄位 | 範例值 | 自動生成的UID |
|----------|----------|--------|---------------|
| **300B 健康監測手錶** | MAC地址 | `E0:0E:08:36:93:F8` | `300B:E0:0E:08:36:93:F8` |
| **DIAPER 智能尿布傳感器** | MAC地址 | `E0:0E:08:36:94:A2` | `DIAPER:E0:0E:08:36:94:A2` |
| **PEDO 運動傳感器** | 設備ID | `5345` | `PEDO:5345` |
| **TAG UWB定位標籤** | 設備ID | `23349` | `TAG:23349` |

**設備註冊步驟：**
1. 進入「設備管理」頁面 (`/devices`)
2. 點擊「新增設備」按鈕
3. 選擇設備類型
4. 填寫設備名稱和硬體編號
5. 根據設備類型填寫：
   - **MAC地址**（300B、DIAPER）
   - **設備ID**（PEDO、TAG）
6. 點擊「新增設備」完成註冊

#### **第二步：病患設備綁定** (`ResidentsPage.tsx`)
設備註冊完成後，在院友管理頁面進行綁定：

**綁定操作步驟：**
1. 進入「院友管理」頁面 (`/residents`)
2. 找到目標院友，點擊「管理設備」按鈕
3. 在彈出窗口中：
   - 選擇要綁定的設備
   - 選擇綁定類型（主要/輔助）
   - 確認綁定關係
4. 查看綁定結果：院友卡片顯示關聯設備

#### **第三步：健康監控查看** (`HealthPage.tsx`)
綁定完成後，在健康監控頁面查看整合結果：

**監控功能：**
- 系統概覽統計（總院友、活躍設備、離線設備、異常設備）
- 病患狀態卡片（基於設備狀態自動計算）
- 設備狀態快覽（電池、連線、運行數據）
- 監控功能導航（體溫、心率、尿布、運動、定位等）

## 🔧 **詳細操作指南**

### **設備註冊詳細流程**

#### **300B 健康監測手錶**
```typescript
// 註冊信息
{
  deviceType: "300B",
  name: "健康監測手錶 #1",
  hardwareId: "HWID-W23445",
  mac: "E0:0E:08:36:93:F8",        // ← 必需：MAC地址
  gatewayId: "137205"                // ← 選填：網關ID
}

// 自動生成的設備UID
"300B:E0:0E:08:36:93:F8"
```

#### **DIAPER 智能尿布傳感器**
```typescript
// 註冊信息
{
  deviceType: "DIAPER",
  name: "智能尿布傳感器 #1",
  hardwareId: "HWID-D23001",
  mac: "E0:0E:08:36:94:A2",        // ← 必需：MAC地址
  gatewayId: "137205"                // ← 選填：網關ID
}

// 自動生成的設備UID
"DIAPER:E0:0E:08:36:94:A2"
```

#### **PEDO 運動傳感器**
```typescript
// 註冊信息
{
  deviceType: "PEDO",
  name: "運動傳感器 #1",
  hardwareId: "PEDO-5345",
  deviceId: "5345",                  // ← 必需：設備ID
  gatewayId: "1612681207"            // ← 選填：網關ID
}

// 自動生成的設備UID
"PEDO:5345"
```

#### **TAG UWB定位標籤**
```typescript
// 註冊信息
{
  deviceType: "TAG",
  name: "UWB定位標籤 #1",
  hardwareId: "DW5B35",
  deviceId: "23349",                 // ← 必需：設備ID
  gatewayId: "137205"                // ← 選填：網關ID
}

// 自動生成的設備UID
"TAG:23349"
```

### **病患綁定詳細流程**

#### **單一設備綁定**
1. **選擇院友**：點擊院友卡片或「管理設備」按鈕
2. **選擇設備**：從可用設備列表中選擇
3. **設定綁定類型**：
   - **主要設備**：核心監控設備（如300B手錶）
   - **輔助設備**：補充監控設備（如尿布傳感器）
4. **確認綁定**：點擊「確認綁定」完成

#### **批量設備管理**
1. **查看未綁定設備**：點擊「顯示設備管理」按鈕
2. **直接綁定**：在未綁定設備區域點擊「綁定」按鈕
3. **快速分配**：選擇目標院友完成綁定

### **狀態監控詳細說明**

#### **病患狀態計算邏輯**
```typescript
function calculatePatientStatus(residentId: string) {
  const devices = getDevicesForResident(residentId)

  if (devices.length === 0) return "無設備"

  const hasError = devices.some(d => d.status === DeviceStatus.ERROR)
  const hasOffline = devices.some(d => d.status === DeviceStatus.OFFLINE)
  const allActive = devices.every(d => d.status === DeviceStatus.ACTIVE)

  if (hasError) return "異常"        // 🔴 有設備故障
  if (hasOffline) return "需注意"    // 🟡 有設備離線
  if (allActive) return "正常"       // 🟢 所有設備正常
  return "需注意"                    // 🟡 其他情況
}
```

#### **設備狀態監控**
- **🟢 活躍**: 正常運作並發送數據
- **🟡 待機**: 設備連線但暫時無活動
- **⚪ 離線**: 設備未連線或超時
- **🔴 異常**: 設備報告錯誤或故障

## 📊 **數據流程圖**

```
┌─────────────────┐    ┌──────────────────┐    ┌─────────────────┐
│   設備註冊      │    │   病患綁定       │    │   健康監控      │
│                 │    │                  │    │                 │
│ 1. 選擇設備類型 │───▶│ 1. 選擇院友      │───▶│ 1. 查看系統概覽 │
│ 2. 填寫識別信息 │    │ 2. 選擇設備      │    │ 2. 瀏覽病患狀態 │
│ 3. 生成設備UID  │    │ 3. 設定綁定類型 │    │ 3. 監控設備數據 │
│ 4. 加入系統     │    │ 4. 確認綁定關係 │    │ 4. 導航功能頁面 │
└─────────────────┘    └──────────────────┘    └─────────────────┘
         │                       │                       │
         ▼                       ▼                       ▼
┌─────────────────┐    ┌──────────────────┐    ┌─────────────────┐
│ DeviceManagement│    │ DeviceBinding    │    │ HealthMonitoring│
│ Context         │    │ System           │    │ Dashboard       │
│                 │    │                  │    │                 │
│ • 設備列表      │    │ • 綁定關係       │    │ • 實時狀態      │
│ • 設備狀態      │    │ • 綁定類型       │    │ • 統計數據      │
│ • 設備類型      │    │ • 綁定歷史       │    │ • 告警通知      │
└─────────────────┘    └──────────────────┘    └─────────────────┘
```

## 🎯 **使用建議**

### **初次設置**
1. **優先完成設備註冊**：確保所有設備都在系統中
2. **按類型分批註冊**：先註冊主要設備（300B手錶），再註冊輔助設備
3. **記錄設備信息**：保存好MAC地址和設備ID，避免重複輸入

### **日常管理**
1. **定期檢查設備狀態**：查看電池電量和連線狀態
2. **及時處理異常設備**：更換電池、檢查連線、重啟設備
3. **維護綁定關係**：設備更換時及時更新綁定

### **監控優化**
1. **合理分配設備**：主要設備綁定到需要密切監控的病患
2. **平衡設備負載**：避免單一病患綁定過多設備
3. **定期評估效果**：根據監控數據調整設備配置

## ⚠️ **注意事項**

### **設備識別要求**
- **300B/Diaper**: 必須提供有效的MAC地址格式
- **PEDO/TAG**: 必須提供唯一的設備ID
- **硬體編號**: 建議使用有規律的編號系統

### **綁定限制**
- 一個設備只能綁定一個病患
- 一個病患可以綁定多個設備
- 綁定關係可以隨時調整

### **數據同步**
- 設備狀態每30秒自動更新
- 綁定關係變更即時生效
- 歷史數據保留在系統中

## 🏆 **系統優勢**

### **標準化流程**
- ✅ 統一的設備註冊流程
- ✅ 標準化的設備UID格式
- ✅ 一致的綁定操作界面

### **智能管理**
- ✅ 自動設備類型識別
- ✅ 智能狀態計算
- ✅ 實時數據同步

### **用戶友善**
- ✅ 直觀的操作界面
- ✅ 清晰的狀態指示
- ✅ 完整的操作反饋

---

## 🎊 **總結**

您的理解完全正確！系統設計為：

1. **設備註冊** → 在 `DeviceManagementPage.tsx` 完成設備加入
2. **病患綁定** → 在 `ResidentsPage.tsx` 完成設備-病患關聯
3. **健康監控** → 在 `HealthPage.tsx` 查看整合結果

這個流程確保了：
- 🔑 **設備唯一性**: 通過標準化UID系統
- 🔗 **關聯完整性**: 病患與設備的明確綁定關係
- 📊 **監控有效性**: 基於實際設備狀態的健康評估

系統現已完全準備好，您可以開始使用這個完整的設備管理流程！🚀
