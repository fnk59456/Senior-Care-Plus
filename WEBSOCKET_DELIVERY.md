# WebSocket åŠŸèƒ½äº¤ä»˜èªªæ˜

## ğŸ“¦ äº¤ä»˜å…§å®¹

### âœ… å·²å®ŒæˆåŠŸèƒ½

**é‡å°å» å•†çŸ­æœŸéœ€æ±‚**ï¼š
1. âœ… Gateway é é¢æœ¬åœ°å¾Œç«¯åŒ–
2. âœ… Anchor é é¢æœ¬åœ°å¾Œç«¯åŒ–
3. âœ… å®¤å…§å®šä½é é¢ WebSocket æ”¯æŒ

---

## ğŸš€ å¿«é€Ÿé–‹å§‹ï¼ˆæ¸¬è©¦ WebSocketï¼‰

### 1. å®‰è£ä¾è³´

```bash
npm install ws
```

### 2. å•Ÿå‹•æœå‹™

```bash
# çµ‚ç«¯ 1ï¼šå•Ÿå‹• MQTT Broker
mosquitto -c mosquitto.conf -v

# çµ‚ç«¯ 2ï¼šå•Ÿå‹•æœ¬åœ°å¾Œç«¯
node test-backend-with-db.js

# çµ‚ç«¯ 3ï¼šå•Ÿå‹•å‰ç«¯
npm run dev
```

### 3. æ¸¬è©¦ WebSocket

è¨ªå•æ¸¬è©¦é é¢ï¼š`http://localhost:5173/test/websocket`

æˆ–ä½¿ç”¨ç€è¦½å™¨æ§åˆ¶å°ï¼š
```javascript
const ws = new WebSocket('ws://localhost:3002')
ws.onmessage = (e) => console.log('æ”¶åˆ°æ¶ˆæ¯:', JSON.parse(e.data))
```

ç™¼å¸ƒæ¸¬è©¦æ¶ˆæ¯ï¼š
```bash
mosquitto_pub -h localhost -p 1883 -t "UWB/location/test" -m '{"x":12.34,"y":56.78}'
```

---

## ğŸ“š æ–‡æª”ä½ç½®

### çµ¦å¾Œç«¯å·¥ç¨‹å¸«

| æ–‡æª” | è·¯å¾‘ | ç”¨é€” |
|------|------|------|
| **WebSocket æ¥å£è¦ç¯„** | `docs/websocket-api-specification.md` | å®Œæ•´çš„æ¥å£å®šç¾© |
| **å¿«é€Ÿé–‹å§‹æŒ‡å—** | `docs/websocket-quick-start.md` | æ¸¬è©¦å’Œé©—è­‰ |
| **å¯¦æ–½ç¸½çµ** | `docs/websocket-implementation-summary.md` | å®Œæ•´çš„å¯¦æ–½èªªæ˜ |
| **åƒè€ƒå¯¦ç¾** | `test-backend-with-db.js` | å¯é‹è¡Œçš„ä»£ç¢¼ |

### å‰ç«¯æœå‹™

| æ–‡ä»¶ | è·¯å¾‘ | ç”¨é€” |
|------|------|------|
| **WebSocket å®¢æˆ¶ç«¯** | `src/services/websocketService.ts` | å‰ç«¯æœå‹™ |
| **æ¸¬è©¦é é¢** | `src/pages/WebSocketTestPage.tsx` | æ¸¬è©¦ç•Œé¢ |

---

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

### å¾Œç«¯ï¼ˆtest-backend-with-db.jsï¼‰

- âœ… WebSocket æœå‹™å™¨ï¼ˆç«¯å£ 3002ï¼‰
- âœ… MQTT æ¶ˆæ¯æ¥æ”¶
- âœ… **æ¶ˆæ¯å»é‡æ©Ÿåˆ¶**ï¼ˆé˜²æ­¢é‡è¤‡ï¼‰
- âœ… æ¶ˆæ¯æ¨é€åˆ°æ‰€æœ‰å‰ç«¯å®¢æˆ¶ç«¯
- âœ… è‡ªå‹•æ¸…ç†éæœŸè¨˜éŒ„

### å‰ç«¯ï¼ˆwebsocketService.tsï¼‰

- âœ… WebSocket é€£æ¥ç®¡ç†
- âœ… è‡ªå‹•é‡é€£ï¼ˆæŒ‡æ•¸é€€é¿ï¼‰
- âœ… æ¶ˆæ¯è¨‚é–±å’Œåˆ†ç™¼
- âœ… é€£æ¥ç‹€æ…‹ç›£è½
- âœ… Topic æ¨¡å¼åŒ¹é…

---

## ğŸ“‹ å¾Œç«¯å·¥ç¨‹å¸«å¾…è¾¦äº‹é …

### æ­¥é©Ÿ 1ï¼šç†Ÿæ‚‰åƒè€ƒå¯¦ç¾
```bash
# é‹è¡Œæœ¬åœ°å¾Œç«¯
node test-backend-with-db.js

# æŸ¥çœ‹é—œéµä»£ç¢¼
# - WebSocket æœå‹™å™¨ï¼šç¬¬ 93-185 è¡Œ
# - æ¶ˆæ¯å»é‡ï¼šç¬¬ 97-113 è¡Œ
# - MQTT è™•ç†ï¼šç¬¬ 226-260 è¡Œ
```

### æ­¥é©Ÿ 2ï¼šé–±è®€æ–‡æª”
1. `docs/websocket-api-specification.md` - æ¥å£è¦ç¯„
2. `docs/websocket-quick-start.md` - å¿«é€Ÿé–‹å§‹

### æ­¥é©Ÿ 3ï¼šå¯¦ç¾é›²ç«¯æœå‹™
- [ ] å¯¦ç¾ MQTT é€£æ¥ç®¡ç†
- [ ] å¯¦ç¾æ¶ˆæ¯å»é‡ï¼ˆåƒè€ƒæœ¬åœ°å¯¦ç¾ï¼‰
- [ ] å¯¦ç¾ WebSocket æœå‹™å™¨
- [ ] æ·»åŠ èªè­‰å’Œæˆæ¬Š
- [ ] éƒ¨ç½²åˆ°é›²ç«¯

### æ­¥é©Ÿ 4ï¼šè¯èª¿æ¸¬è©¦
- [ ] èˆ‡å‰ç«¯è¯èª¿
- [ ] æ€§èƒ½æ¸¬è©¦
- [ ] é©—æ”¶æ¸¬è©¦

---

## ğŸ”§ ç’°å¢ƒé…ç½®

### ç•¶å‰ï¼ˆé–‹ç™¼ç’°å¢ƒï¼‰

```env
# .env.development
VITE_WS_URL=ws://localhost:3002
VITE_API_BASE_URL=http://localhost:3001/api
```

### æœªä¾†ï¼ˆç”Ÿç”¢ç’°å¢ƒï¼‰

```env
# .env.production
VITE_WS_URL=wss://api.seniorcare.com/ws
VITE_API_BASE_URL=https://api.seniorcare.com/api
```

---

## ğŸ“Š æ¶æ§‹èªªæ˜

### ç•¶å‰æ¶æ§‹
```
MQTT Broker
    â†“
æœ¬åœ°å¾Œç«¯ (test-backend-with-db.js)
    â”œâ”€â”€ æ¶ˆæ¯å»é‡
    â””â”€â”€ WebSocket æ¨é€
        â†“
å‰ç«¯
```

### ç›®æ¨™æ¶æ§‹ï¼ˆå¾Œç«¯å·¥ç¨‹å¸«å¯¦ç¾ï¼‰
```
MQTT Broker (HiveMQ Cloud)
    â†“
é›²ç«¯å¾Œç«¯ (Ktor/Node.js)
    â”œâ”€â”€ Cloud Dataflow (å»é‡ã€åˆ†æµ)
    â”œâ”€â”€ Redis (å³æ™‚å¿«å–)
    â”œâ”€â”€ BigQuery (æ­·å²æ­¸æª”)
    â””â”€â”€ WebSocket æ¨é€
        â†“
å‰ç«¯
```

---

## âœ… é©—æ”¶æ¨™æº–

- [ ] WebSocket èƒ½é€£æ¥
- [ ] èƒ½æ”¶åˆ° MQTT æ¨é€
- [ ] æ¶ˆæ¯æ ¼å¼æ­£ç¢º
- [ ] å»é‡æ©Ÿåˆ¶æ­£å¸¸
- [ ] è‡ªå‹•é‡é€£æ­£å¸¸
- [ ] æ€§èƒ½ç¬¦åˆè¦æ±‚ï¼ˆ< 100ms å»¶é²ï¼‰

---

## ğŸ“ è¯ç¹«æ–¹å¼

å¦‚æœ‰ç–‘å•ï¼Œè«‹åƒè€ƒï¼š
- æ–‡æª”ï¼š`docs/` ç›®éŒ„
- åƒè€ƒä»£ç¢¼ï¼š`test-backend-with-db.js`

---

**ç‹€æ…‹**: âœ… å·²å®Œæˆä¸¦å¯äº¤ä»˜
**æ—¥æœŸ**: 2025-11-12

